# üõ¢ Production Log Aggregator ‚Äî –†–∞—É–Ω–¥ 1

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

–í–∞–º –¥–∞–Ω –ª–æ–≥ –¥–æ–±—ã—á–∏ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –Ω–µ—Ñ—Ç—è–Ω—ã–º —Å–∫–≤–∞–∂–∏–Ω–∞–º.  
–î–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏.

–í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫–æ–≤—ã–π –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π:

1. –æ—á–∏—â–∞–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ,
2. –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø–æ —Å–∫–≤–∞–∂–∏–Ω–∞–º,
3. –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã,
4. —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–≥–æ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥.

---

## ‚öôÔ∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ —Å–µ–∫—Ü–∏–∏ `DATA` –º–æ–∂–µ—Ç –¥–æ—Å—Ç–∏–≥–∞—Ç—å **10^7**.
- –í—Ö–æ–¥ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å **–≤ –ø–æ—Ç–æ–∫–æ–≤–æ–º —Ä–µ–∂–∏–º–µ**.
- –†–µ—à–µ–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Ü–µ–ª–∏–∫–æ–º.
- –°–µ–∫—Ü–∏—è `DATA` –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ `timestamp` –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é.
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–∏–ø `double` –¥–ª—è –≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.
- –í—ã–≤–æ–¥ —á–∏—Å–µ–ª ‚Äî —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é **6 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π**.
- –ü—Ä–æ–≥—Ä–∞–º–º–∞ —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ **stdin** –∏ –ø–∏—à–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ **stdout**.

---

## üì• –§–æ—Ä–º–∞—Ç –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–í—Ö–æ–¥ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —Å–µ–∫—Ü–∏–π:

QUERIES
...
DATA
...
END

---

## üìä –°–µ–∫—Ü–∏—è DATA

–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –∏–º–µ–µ—Ç —Ñ–æ—Ä–º–∞—Ç:

```
well_id,timestamp,oil_rate,water_rate,pressure
```

–ì–¥–µ:

- **`well_id`** ‚Äî –Ω–µ–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –±–µ–∑ –∑–∞–ø—è—Ç—ã—Ö  
  –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–∫–≤–∞–∂–∏–Ω—ã.  
  –í—Å–µ –∑–∞–ø–∏—Å–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º `well_id` –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ —Å–∫–≤–∞–∂–∏–Ω–µ.

- **`timestamp`** ‚Äî —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ (`long`)  
  –ú–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, Unix time).  
  –í —Ä–∞–º–∫–∞—Ö –≤—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:
    - —Å—Ç—Ä–æ–∫–∏ –≤ —Å–µ–∫—Ü–∏–∏ `DATA` –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ `timestamp` –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é
    - –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ `timestamp` –¥–æ–ø—É—Å—Ç–∏–º—ã
    - –¥–ª—è –æ–¥–Ω–æ–π —Å–∫–≤–∞–∂–∏–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –Ω–µ —É–±—ã–≤–∞—é—Ç

- **`oil_rate`** ‚Äî –≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ (`double`)  
  –î–µ–±–∏—Ç –Ω–µ—Ñ—Ç–∏ ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—Ñ—Ç–∏, –¥–æ–±—ã–≤–∞–µ–º–æ–µ —Å–∫–≤–∞–∂–∏–Ω–æ–π –≤ –µ–¥–∏–Ω–∏—Ü—É –≤—Ä–µ–º–µ–Ω–∏  
  (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–∞—Ä—Ä–µ–ª–µ–π –≤ —Å—É—Ç–∫–∏).  
  –ó–Ω–∞—á–µ–Ω–∏–µ ‚â• 0.

- **`water_rate`** ‚Äî –≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ (`double`)  
  –î–µ–±–∏—Ç –≤–æ–¥—ã ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–¥—ã, –ø–æ—Å—Ç—É–ø–∞—é—â–µ–π –≤–º–µ—Å—Ç–µ —Å –ø—Ä–æ–¥—É–∫—Ü–∏–µ–π —Å–∫–≤–∞–∂–∏–Ω—ã  
  (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–∞—Ä—Ä–µ–ª–µ–π –≤ —Å—É—Ç–∫–∏).  
  –ó–Ω–∞—á–µ–Ω–∏–µ ‚â• 0.

- **`pressure`** ‚Äî –≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ (`double`)  
  –ó–∞–±–æ–π–Ω–æ–µ –∏–ª–∏ —É—Å—Ç—å–µ–≤–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ —Å–∫–≤–∞–∂–∏–Ω—ã –≤ –º–æ–º–µ–Ω—Ç –∏–∑–º–µ—Ä–µ–Ω–∏—è  
  (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –±–∞—Ä–∞—Ö –∏–ª–∏ –ú–ü–∞).  
  –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–∏.

---

### üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ—è—Å–Ω–µ–Ω–∏—è

- –°—É–º–º–∞—Ä–Ω–∞—è –∂–∏–¥–∫–æ—Å—Ç—å = `oil_rate + water_rate`
- –û—Ç–Ω–æ—à–µ–Ω–∏–µ –≤–æ–¥—ã –∫ –∂–∏–¥–∫–æ—Å—Ç–∏ (`water_rate / (oil_rate + water_rate)`) –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **water cut**
- –î–∞–≤–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–Ω–∞–º–∏–∫–∏ —Å–∫–≤–∞–∂–∏–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–µ–∑–∫–∏—Ö –ø–∞–¥–µ–Ω–∏–π –¥–∞–≤–ª–µ–Ω–∏—è)

### –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–°—Ç—Ä–æ–∫–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, –µ—Å–ª–∏:

1. –ù–µ–≤–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–π.
2. –õ—é–±–æ–µ —á–∏—Å–ª–æ–≤–æ–µ –ø–æ–ª–µ –Ω–µ –ø–∞—Ä—Å–∏—Ç—Å—è.
3. `oil_rate < 0` –∏–ª–∏ `water_rate < 0`.

### –î—É–±–ª–∏–∫–∞—Ç—ã

–î—É–±–ª–∏–∫–∞—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ –ø–∞—Ä–µ:

(well_id, timestamp)

–ï—Å–ª–∏ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ `(well_id, timestamp)`,
—É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω—è—è –≤—Å—Ç—Ä–µ—á–µ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –≤–æ –≤—Ö–æ–¥–µ**.

---

## üìä –ê–≥—Ä–µ–≥–∞—Ü–∏—è

–ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è –ø–æ –∫–∞–∂–¥–æ–π —Å–∫–≤–∞–∂–∏–Ω–µ.

---

## üì• –°–µ–∫—Ü–∏—è QUERIES

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã.

---

### 1Ô∏è‚É£ AVG_OIL well_id=XXX

–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `oil_rate` –ø–æ –≤—Å–µ–º –∑–∞–ø–∏—Å—è–º —Å–∫–≤–∞–∂–∏–Ω—ã.

–ï—Å–ª–∏ —Å–∫–≤–∞–∂–∏–Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ –∏–º–µ–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π ‚Äî –≤—ã–≤–µ—Å—Ç–∏:

NA

---

### 2Ô∏è‚É£ WATER_CUT well_id=XXX

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–∞–∫:

sum(water_rate) / sum(oil_rate + water_rate)

–ï—Å–ª–∏ `sum(oil_rate + water_rate) == 0`, —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ä–∞–≤–Ω—ã–º:

0.000000

–ï—Å–ª–∏ —Å–∫–≤–∞–∂–∏–Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –≤—ã–≤–µ—Å—Ç–∏:

NA

---

### 3Ô∏è‚É£ TOP_WELLS_BY_OIL k=N

–í—ã–≤–µ—Å—Ç–∏ `k` —Å–∫–≤–∞–∂–∏–Ω —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º–æ–π `oil_rate`.

–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:

1. –ü–æ —Å—É–º–º–∞—Ä–Ω–æ–º—É `oil_rate` (–ø–æ —É–±—ã–≤–∞–Ω–∏—é).
2. –ü—Ä–∏ —Ä–∞–≤–µ–Ω—Å—Ç–≤–µ ‚Äî –ø–æ `well_id` (–ª–µ–∫—Å–∏–∫–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é).

–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞:

W1,W2,W3

–ë–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤.

–ï—Å–ª–∏ —Å–∫–≤–∞–∂–∏–Ω –º–µ–Ω—å—à–µ, —á–µ–º `k` ‚Äî –≤—ã–≤–µ—Å—Ç–∏ –≤—Å–µ.

–ï—Å–ª–∏ –≤–∞–ª–∏–¥–Ω—ã—Ö —Å–∫–≤–∞–∂–∏–Ω –Ω–µ—Ç ‚Äî –≤—ã–≤–µ—Å—Ç–∏ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É.

---

## üì§ –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è **–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞** –≤ —Ç–æ–º –∂–µ –ø–æ—Ä—è–¥–∫–µ.

–í–µ—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —á–∏—Å–ª–∞ –≤—ã–≤–æ–¥—è—Ç—Å—è —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é **6 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π**.

–ü—Ä–∏–º–µ—Ä:

12.345678  
0.000000  
W1,W3  
NA

---

## üìå –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –í—ã–≤–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–≥–æ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º.
- –õ–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã.
- –ü–æ—Ä—è–¥–æ–∫ —Å—Ç—Ä–æ–∫ –≤—ã–≤–æ–¥–∞ –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –ø–æ—Ä—è–¥–∫–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤.
- –†–µ—à–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ –æ–±—ä—ë–º–µ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–æ 10^7 —Å—Ç—Ä–æ–∫.
